version: 1.0.{build}
shallow_clone: true
clone_folder: C:\Projects\libsfw
init:
- ps: >-
    Start-process -FilePath msiexec -ArgumentList '/X','{177B605A-B1E1-3197-B5D4-05F00C0174D1}','/q' -Wait;

    Start-Process -FilePath "C:\Program Files (x86)\Mozilla Maintenance Service\uninstall.exe" -ArgumentList '/S' -Wait

    Invoke-WebRequest -UseBasicParsing -Uri https://raw.githubusercontent.com/repasscloud/init-files/main/mc/config.json -OutFile C:\Users\appveyor\AppData\Roaming\mc-config.json

    (Get-Content -Path C:\Users\appveyor\AppData\Roaming\mc-config.json) -replace "MC_ACCESS_KEY", "$env:AU_SYD1_07_AK" | Out-File -FilePath C:\Users\appveyor\AppData\Roaming\mc-config.json -Force

    (Get-Content -Path C:\Users\appveyor\AppData\Roaming\mc-config.json) -replace "MC_SECRET_KEY", "$env:AU_SYD1_07_SK" | Out-File -FilePath C:\Users\appveyor\AppData\Roaming\mc-config.json -Force

    (Get-Content -Path C:\Users\appveyor\AppData\Roaming\mc-config.json) -replace "MC_URL", "$env:AU_SYD1_07_URI" | Out-File -FilePath C:\Users\appveyor\AppData\Roaming\mc-config.json -Force    

    #Start-Process -FilePath 'C:\Program Files\Docker\Docker\DockerCli.exe' -ArgumentList '-SwitchDaemon' -Wait

    #docker pull minio/mc
install:
- ps: >-
    Get-ChildItem -Path .\apps -Recurse -Filter "*.ps1" | ForEach-Object { . $_.FullName }
build_script:
- ps: >-
    . .\build.ps1
test_script:
- ps: >-
    Write-Output "This is test script"
deploy_script:
- pwsh: Write-Output "This is deployment script"
on_success:
- ps: '[System.Console]::WriteLine("Success building")'
on_failure:
- ps: $blockRdp = $true; iex ((new-object net.webclient).DownloadString('https://raw.githubusercontent.com/appveyor/ci/master/scripts/enable-rdp.ps1'))
on_finish:
- ps: $blockRdp = $true; iex ((new-object net.webclient).DownloadString('https://raw.githubusercontent.com/appveyor/ci/master/scripts/enable-rdp.ps1'))

# '[System.Console]::WriteLine("Project finished building")'