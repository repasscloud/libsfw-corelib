version: 1.1.{build}-{branch}
branches:
  except:
  - dev
shallow_clone: true
clone_folder: C:\Projects\libsfw
init:
- ps: echo $env:DCKR_PASS | docker login -u $env:DCKR_USR --password-stdin
environment:
  APPS_CS_HOST:
    secure: 0LN4yVhDyvjhf/GohIQo2zjlu6HREy0+iPOqv2gpGnf83Fh2aBI2LlLqXha3ZPnn
  APPS_CS_USR:
    secure: QevHdvXjnMiw7RBZY/u+Kg==
  APPS_CS_PK:
    secure: XH5leZvyuglrkuJAi9zs/u6GQKTUn30U3BLwPOVDj/E=
  AU_SYD1_07_AK:
    secure: CqSOObN1F/aUt+VOcx8g/9EP0b5qvf16joIOZ0eRBjc=
  AU_SYD1_07_SK:
    secure: ZRkGjWO83vo7CTIOBTq+aG9FsrYCZ9TerlIT2hVme3+ETSIQMqoGalOKw5KNOKKx
  AU_SYD1_07_URI:
    secure: ew9e/wrf2ID1kJVMCXZZ6BzhL8884qfKCTNl+j3m1ABpoh1AYEunyrB0yyEsqhYbjTuHbqeYKa6uzVV3ZQwH6w==
  APPVEYOR_RDP_PASSWORD:
    secure: dMDKLaX0ndKbYfVOTlAgdw==
  DCKR_USR:
    secure: hHm0hW6n7R8L4rqUgxBDNg==
  DCKR_PASS:
    secure: 1adnMRwpnhpeW3FAs4GkXVM1M77CA7/4Flsb4gyAEiE=
  DB_HOST:
    secure: 0LN4yVhDyvjhf/GohIQo2zjlu6HREy0+iPOqv2gpGnf83Fh2aBI2LlLqXha3ZPnn
  DB_PORT:
    secure: bQCmTUCMS990Q+HK1w3HSA==
  DB_DB:
    secure: hMtkbwliDinlEU/kQOp+YQ==
  DB_USERID:
    secure: QevHdvXjnMiw7RBZY/u+Kg==
  DB_PASS:
    secure: XH5leZvyuglrkuJAi9zs/u6GQKTUn30U3BLwPOVDj/E=
  GH_POST_API_ATKN:
    secure: 0B0zDa2irOJerEXwNT+1OtbOw2Hn12JtAi8ficex2Bs/XWCtM8tFB19d3ZtIaeGe
  MC_ACCESS_KEY:
    secure: CqSOObN1F/aUt+VOcx8g/9EP0b5qvf16joIOZ0eRBjc=
  MC_SECRET_KEY:
    secure: ZRkGjWO83vo7CTIOBTq+aG9FsrYCZ9TerlIT2hVme3+ETSIQMqoGalOKw5KNOKKx
  MC_URI:
    secure: ew9e/wrf2ID1kJVMCXZZ6BzhL8884qfKCTNl+j3m1ABpoh1AYEunyrB0yyEsqhYbYzPiQKRvg0SvDx8Gwa5V5A==
clone_script:
- ps: >-
    if(-not $env:APPVEYOR_PULL_REQUEST_NUMBER) {
      git clone -q --branch=$env:APPVEYOR_REPO_BRANCH https://github.com/$env:APPVEYOR_REPO_NAME.git $env:APPVEYOR_BUILD_FOLDER
      cd $env:APPVEYOR_BUILD_FOLDER
      git checkout -qf $env:APPVEYOR_REPO_COMMIT
    } else {
      git clone -q https://github.com/$env:APPVEYOR_REPO_NAME.git $env:APPVEYOR_BUILD_FOLDER
      cd $env:APPVEYOR_BUILD_FOLDER
      git fetch -q origin +refs/pull/$env:APPVEYOR_PULL_REQUEST_NUMBER/merge:
      git checkout -qf FETCH_HEAD
    }
- cmd: git submodule update --init --recursive
install:
- ps: .\lib\ci-scripts\appveyor\01_init.ps1
build_script:
- ps: .\lib\ci-scripts\appveyor\02_build.ps1
test_script:
- ps: .\lib\ci-scripts\appveyor\03_test.ps1
deploy_script:
- ps: >-
    .\lib\ci-scripts\appveyor\04_deploy.ps1    

#    $blockRdp = $true; iex ((new-object net.webclient).DownloadString('https://raw.githubusercontent.com/appveyor/ci/master/scripts/enable-rdp.ps1'))
on_success:
- ps: Write-Output "Success building"
on_failure:
- ps: >-
    Write-Output "Project failed";
on_finish:
- ps: .\lib\ci-scripts\appveyor\on_completion.ps1
